
	<script src="<?php echo base_url(); ?>script/dropzone/dropzone.min.js"></script>
	<script src="<?php echo base_url(); ?>script/vis/dist/vis.js"></script>
	
	<script>		

		Dropzone.autoDiscover = false;
		var myDropzone = new Dropzone("#my-dropzone", {

			
			url: "<?php echo site_url("dentist/upload") ?>",
			acceptedFiles: "image/*",
			addRemoveLinks: false,
			removedfile: function(file) {
				var name = file.name;

				$.ajax({
					type: "post",
					url: "<?php echo site_url("dentist/remove") ?>",
					data: { file: name },
					dataType: 'html'
				});

				// remove the thumbnail
				var previewElement;
				return (previewElement = file.previewElement) != null ? (previewElement.parentNode.removeChild(file.previewElement)) : (void 0);
			},

			
				
			complete: function(){
				var me = this;
				$.get("<?php echo site_url("dentist/list_file") ?>", function(data) {
					if (data.length > 0) {
						$.each(data, function(key, value) {
							var mockFile = value;
							items.add({id: items.length+1, group: value.category, content: '<span data-target="#modal_2" data-toggle="modal" onclick="modal_cha(' + value.category + ', \'' + value.folder_name + '\')">#all</span>', start: value.folder_name});
							timeline.fit();
						});
					}
				});
				
			},
			

			init: function() {
				var me = this;
				$.get("<?php echo site_url("dentist/list_files") ?>", function(data) {
					// if any files already in server show all here
					if (data.length > 0) {
						$.each(data, function(key, value) {
							var mockFile = value;
							/*
							me.emit("addedfile", mockFile);
							me.emit("thumbnail", mockFile, "<?php echo base_url(); ?>uploads/" + value.folder_name + "/" + value.name);
							me.emit("complete", mockFile);
							*/		

							items.add({id: items.length+1, group: value.category, content: '<span data-target="#modal_2" data-toggle="modal" onclick="modal_cha(' + value.category + ', \'' + value.folder_name + '\')">#all</span>', start: value.folder_name});
							timeline.fit();
							
						});
					}
				});
			}
		});
/*
		myDropzone.on("addedfile", function(file) {
			var me = this;
			$.get("<?php echo site_url("dentist/upload") ?>", function(data) {
				if (data.length > 0) {
					$.each(data, function(key, value) {
						var mockFile = value;
						items.add({id: items.length+1, group: value.category, content: '<span data-target="#20130420" data-toggle="modal">#all</span>', start: value.folder_name});
					});
				}
			});
		});
*/


		// DOM element where the Timeline will be attached
		var container = document.getElementById('visualization');

		// create a data set with groups
		var names = ['Charts', 'Photo', 'Periapical', 'Panorama'];
		var groups = new vis.DataSet();
		for (var g = 0; g < 4; g++) {
			groups.add({id: g, content: names[g]});
		}

		// Create a DataSet (allows two way data-binding)
		var items = new vis.DataSet([
		//	{id: 1, group: 0, content: '<span data-target="#20130420" data-toggle="modal">charting</span>', start: '2013-04-20'},
		//	{id: 2, group: 1, content: '<span data-target="#20130414" data-toggle="modal">#all</span>', start: '2013-04-14'},
		//	{id: 3, group: 2, content: '<span data-target="#20130416" data-toggle="modal">#all</span>', start: '2013-04-16'},
		//	{id: 4, group: 3, content: '<span data-target="#20130418" data-toggle="modal">#all</span>', start: '2013-04-18'}
		]);

		// Configuration for the Timeline
		var options = {
			editable: false,
			min: "2000-01-01",
			//max: new Date,
			max: new Date(new Date().getTime()+(365*24*60*60*1000)),
			zoomMin: 600000*60*24
		};

		// Create a Timeline
		var timeline = new vis.Timeline(container, items, options, groups);


		//$('#example').timeliny();
		$(document).ready(function(){
			$('.dropdown-submenu a.test').on("click", function(e){
				$(this).next('ul').toggle();
				e.stopPropagation();
				e.preventDefault();
			});
		});

		function modal_cha(a, b){
			$("#modal_2_html").html("");
			$.ajax({
				url: "<?php echo site_url("dentist/get_images") ?>",
				type: "POST",
				data: {
					category : a,
					folder_name : b
				},
				cache: false,
				dataType: 'json',
				success: function(data) {	
					var args = "";
					if (data.length > 0) {
						$.each(data, function(key, value) {
							var mockFile = value;
							if (args == "")
							{
								arg = "<div class='item active'><img src='<?php echo base_url(); ?>uploads/" + b + "/" + value.local_name + "'><div class='carousel-caption'><h2>장민정</h2><p>" + value.folder_name + "</p></div></div>";
							}
							else
							{
								arg = "<div class='item'><img src='<?php echo base_url(); ?>uploads/" + b + "/" + value.local_name + "'><div class='carousel-caption'><h2>장민정</h2><p>" + value.folder_name + "</p></div></div>";
							}
							
							args = args + arg;
						});
					}					
					$('#modal_2_html').html(args);
				},
				error: function(request,status,error){
				 	alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); 				
				},
			})
		}


		function incrementValue(e, a)
		{
			var b = $(e).text();
			var c = "";

			switch (a)
			{
			
			case 'Pain_History' :
				switch (b)
				{
				case "first time" : c = "experienced";
					break;
				case "experienced" : c = "others";
					break;
				case "others" : c = "";
					break;
				default : c = "first time";
					break;
				}
				break;
			case 'Pain_Duration' :
				switch (b)
				{
				case "come and go" : c = "persistent";
					break;
				case "persistent" : c = "others";
					break;
				case "others" : c = "";
					break;
				default : c = "come and go";
					break;
				}
				break;	
			case 'Pain_Onset' :
				switch (b)
				{
				case "cold" : c = "hot";
					break;
				case "hot" : c = "breathing in";
					break;
				case "breathing in" : c = "chewing";
					break;
				case "chewing" : c = "physical activity";
					break;
				case "physical activity" : c = "a sweet";
					break;
				case "a sweet" : c = "saltiness";
					break;
				case "saltiness" : c = "tongue push";
					break;
				case "tongue push" : c = "cutlery touch";
					break;
				case "cutlery touch" : c = "";
					break;
				default : c = "cold";
					break;
				}
				break;	
			case 'Pain_Frequency' :
				switch (b)
				{
				case "once in 6 month" : c = "once a month";
					break;
				case "once a month" : c = "twice a month";
					break;
				case "twice a month" : c = "once a week";
					break;
				case "once a week" : c = "twice a week";
					break;
				case "twice a week" : c = "once in two days";
					break;
				case "once in two days" : c = "once in a day";
					break;
				case "once in a day" : c = "all day long";
					break;
				case "all day long" : c = "";
					break;
				default : c = "once in 6 month";
					break;
				}
				break;				
			case 'Pain_Type' :
				switch (b)
				{
				case "vague" : c = "sharp";
					break;
				case "sharp" : c = "dull ache";
					break;
				case "dull ache" : c = "throbbing";
					break;
				case "throbbing" : c = "surging";
					break;
				case "surging" : c = "tingling";
					break;
				case "tingling" : c = "";
					break;
				default : c = "vague";
					break;
				}
				break;
			case 'Pain_Pattern' :
				switch (b)
				{
				case "worse at mealtimes" : c = "worse at night";
					break;
				case "worse at night" : c = "worse in the morning";
					break;
				case "worse in the morning" : c = "lying down";
					break;
				case "lying down" : c = "sitting";
					break;
				case "sitting" : c = "standing up";
					break;
				case "standing up" : c = "";
					break;
				default : c = "worse at mealtimes";
					break;
				}
				break;				
			case 'Pain_Referral' :
				switch (b)
				{
				case "head" : c = "eye";
					break;
				case "eye" : c = "ear";
					break;
				case "ear" : c = "shoulder";
					break;
				case "shoulder" : c = "";
					break;
				default : c = "head";
					break;
				}
				break;						
			
			case 'Probing' :
				switch (b)
				{
				case "1" : c = "2";
					break;
				case "2" : c = "3";
					break;
				case "3" : c = "4";
					break;
				case "4" : c = "5";
					break;
				case "5" : c = "6";
					break;
				case "6" : c = "7";
					break;
				case "7" : c = "8";
					break;
				case "8" : c = "9";
					break;
				case "9" : c = "10";
					break;
				case "10" : c = "";
					break;
				default : c = "1";
					break;
				}
				break;

			case 'EPT' :
				switch (b)
				{
				case "-" : c = "+";
					break;
				case "+" : c = "";
					break;
				default : c = "-";
					break;
				}
				break;

			case 'Cold' :
				switch (b)
				{
				case "-" : c = "+";
					break;
				case "+" : c = "++";
					break;
				case "++" : c = "+++";
					break;
				case "+++" : c = "";
					break;
				default : c = "-";
					break;
				}
				break;

			case 'Hot' :
				switch (b)
				{
				case "-" : c = "+";
					break;
				case "+" : c = "++";
					break;
				case "++" : c = "+++";
					break;
				case "+++" : c = "";
					break;
				default : c = "-";
					break;
				}
				break;

			case 'Per' :
				switch (b)
				{
				case "-" : c = "+";
					break;
				case "+" : c = "";
					break;
				default : c = "-";
					break;
				}
				break;

			case 'Mob' :
				switch (b)
				{				
				case "1" : c = "2";
					break
				case "2" : c = "3";
					break
				case "3" : c = "";
					break
				default : c = "1";
					break;
				}
				break;

			case 'Crown' :
				switch (b)
				{				
				case "Acrylic Resin" : c = "Gold";
					break;
				case "Gold" : c = "PFM";
					break;
				case "PFM" : c = "PFG";
					break;
				case "PFG" : c = "Porcelain";
					break;
				case "Porcelain" : c = "Zirconia";
					break;
				case "Zirconia" : c = "";
					break;
				default : c = "Acrylic Resin";
					break;
				}
				break;
			
			case 'Class' :
				switch (b)
				{				
				case "Resin" : c = "GI";
					break;
				case "GI" : c = "Amalgam";
					break;
				case "Amalgam" : c = "Gold";
					break;
				case "Gold" : c = "";
					break;
				default : c = "Resin";
					break;
				}
				break;

			case 'PAI' :
			case 'USPHS' :
				switch (b)
				{				
				case "Alpha" : c = "Bravo";
					break;
				case "Bravo" : c = "Charlie";
					break;
				case "Charlie" : c = "";
					break;
				default : c = "Alpha";
					break;
				}
				break;

			default : c = "";
				break;
			
			}
			
			$(e).text(c);
		}
		

		function test_dmf()
		{
			$(".chart").each(function(index, elem){
				if($(elem).html() != "")
				{
					var elem_class = $(elem).attr("class");
					var elem_classArray = elem_class.split(" ");
					var t_table = elem_classArray[1];
					var t_coloum = elem_classArray[2];
					var t_tn = elem_classArray[3];
					var elem_html = $(elem).html();
					/*
					alert(t_table);
					alert(t_coloum);
					alert(t_tn);
					alert(elem_html);
					*/

					$.ajax({
						url: "<?php echo site_url("dentist/insert_chart") ?>",
						type: "POST",
						data: {
							table : t_table,
							coloum : t_coloum,
							tn : t_tn,
							html : elem_html
						},
						cache: false,
						success: function(data) {	
							alert("suc");
						},
						error: function(request,status,error){
							alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); 				
						},
					})
					
				}
			});
		}

		function chart_list()
		{
			$("#tab_list").html("");
			$("#tab_list").html("");
			var html_tab = "";
			var html_content = "";
			var url = "http://goto.dentist/chart_list.xml";
			var doc = getXMLDom(url);
			var doc_1 = doc.childNodes[0].childNodes;
			var html_content_ex = "";
			for(var i=0; i<doc_1.length; i++)
			{
				var tagName = doc_1[i].tagName;
				if(typeof(tagName) != "undefined"){
					if(i==1){
						html_tab = html_tab + "<li role='presentation' class='active'><a href='#" + tagName + "' aria-controls='" + tagName + "' role='tab' data-toggle='tab'>" + tagName + "</a></li>";
					}else{
						html_tab = html_tab + "<li role='presentation'><a href='#" + tagName + "' aria-controls='" + tagName + "' role='tab' data-toggle='tab'>" + tagName + "</a></li>";
					}						
				

					var doc_2 = doc_1[i].childNodes;

					if(typeof(tagName) != "undefined"){
						if(i==1){
							html_content = html_content + "<div role='tabpanel' class='row tab-pane fade in active' id='" + tagName + "'>";
							html_content = html_content +	"<div class='col-md-12'>";
							html_content = html_content +		"<table class='table table-bordered table-hover table-condensed' style='text-align:center;'>";
							html_content = html_content +			"<tbody>";
						}else{
							html_content = html_content + "<div role='tabpanel' class='row tab-pane fade' id='" + tagName + "'>";
							html_content = html_content +	"<div class='col-md-12'>";
							html_content = html_content +		"<table class='table table-bordered table-hover table-condensed' style='text-align:center;'>";
							html_content = html_content +			"<tbody>";
						}						
					}

					for(var j=0; j<doc_2.length; j++)
					{
						var tagName_1 = doc_2[j].tagName;
						if(typeof(tagName_1) != "undefined"){	
							html_content = html_content + "<tr>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 18'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 17'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 16'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 15'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 14'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 13'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 12'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 11'></td>";
							html_content = html_content +	"<td>" + tagName_1 + "</td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 21'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 22'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 23'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 24'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 25'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 26'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 27'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 28'></td>";
							html_content = html_content + "</tr>";
						}
					}

					html_content = html_content + "<tr class='info'>";
					html_content = html_content +	"<td>18</td>";
					html_content = html_content +	"<td>17</td>";
					html_content = html_content +	"<td>16</td>";
					html_content = html_content +	"<td>15</td>";
					html_content = html_content +	"<td>14</td>";
					html_content = html_content +	"<td>13</td>";
					html_content = html_content +	"<td>12</td>";
					html_content = html_content +	"<td>11</td>";
					html_content = html_content +	"<td></td>";
					html_content = html_content +	"<td>21</td>";
					html_content = html_content +	"<td>22</td>";
					html_content = html_content +	"<td>23</td>";
					html_content = html_content +	"<td>24</td>";
					html_content = html_content +	"<td>25</td>";
					html_content = html_content +	"<td>26</td>";
					html_content = html_content +	"<td>27</td>";
					html_content = html_content +	"<td>28</td>";
					html_content = html_content + "</tr>";
					html_content = html_content + "<tr class='info'>";
					html_content = html_content +	"<td>48</td>";
					html_content = html_content +	"<td>47</td>";
					html_content = html_content +	"<td>46</td>";
					html_content = html_content +	"<td>45</td>";
					html_content = html_content +	"<td>44</td>";
					html_content = html_content +	"<td>43</td>";
					html_content = html_content +	"<td>42</td>";
					html_content = html_content +	"<td>41</td>";
					html_content = html_content +	"<td></td>";
					html_content = html_content +	"<td>31</td>";
					html_content = html_content +	"<td>32</td>";
					html_content = html_content +	"<td>33</td>";
					html_content = html_content +	"<td>34</td>";
					html_content = html_content +	"<td>35</td>";
					html_content = html_content +	"<td>36</td>";
					html_content = html_content +	"<td>37</td>";
					html_content = html_content +	"<td>38</td>";
					html_content = html_content + "</tr>";

					for(var j=doc_2.length - 1; j>=0; j--)
					{
						var tagName_1 = doc_2[j].tagName;
						if(typeof(tagName_1) != "undefined"){
							html_content = html_content + "<tr>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 18'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 17'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 16'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 15'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 14'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 13'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 12'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 11'></td>";
							html_content = html_content +	"<td>" + tagName_1 + "</td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 21'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 22'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 23'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 24'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 25'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 26'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 27'></td>";
							html_content = html_content +	"<td onclick='incrementValue(this, " + tagName + ", " + tagName_1 + ")' class='chart " + tagName + " " + tagName_1 + " 28'></td>";
							html_content = html_content + "</tr>";
						}
					}
					
					html_content = html_content +			"</tbody>";
					html_content = html_content +		"</table>";
					html_content = html_content +	"</div>";
					html_content = html_content + "</div>";
				}
				
			}

			$("#tab_list").html(html_tab);
			$("#content_list").html(html_content);

		}







		


	// xml 파싱 함수



	var xmlDoc;  //xml DOM

	function getXmlObj()
	{
		var xmlhttp = null;

		// Mozilla/Safari
		if (window.XMLHttpRequest) {
			xmlhttp = new XMLHttpRequest();
		}
		else if (window.ActiveXObject) {// IE
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}

		return xmlhttp;
	}

	function getXMLDom(pUrl,pOption,pSearchValue)
	{
		var xmlhttp = getXmlObj(); 
		var templateStr = null;
		var pAsync = false;

		if (pOption == "TRUE")
		{
			pAsync = true;
		}

		if (pOption == "POST")
		{
			xmlhttp.open("POST",pUrl,pAsync);
			xmlhttp.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
		}
		else
		{
			xmlhttp.open("GET",pUrl,pAsync);

		}
		xmlhttp.onreadystatechange = function () {

			if(xmlhttp.readyState == "4")
			{
				xmlDoc = xmlhttp.responseXML;
			}

		}

		xmlhttp.send(); 
		return xmlDoc;
	}

	function getDomLength(pName,pDom)
	{
		try
		{
			return pDom.getElementsByTagName(pName).length;
		}
		catch (e)
		{
			return xmlDoc.getElementsByTagName(pName).length;
		}
	}

	function getValue(pName,pIndex,pAttr)
	{
		if (typeof pIndex == "undefined" || pIndex =="")
		{
			pIndex = 0;
		}

		x = xmlDoc.getElementsByTagName(pName);

		if (typeof pAttr == "undefined" || pAttr =="")
		{
			if(x[pIndex].hasChildNodes())
			{
				v = x[pIndex].childNodes[0].nodeValue;
			}
			else
			{
				v = "";
			}
		}
		else
		{
			v = x[pIndex].getAttribute(pAttr);
		}

		return v;
	}


	function getXMLText(pCode,pValue)
	{
		var xDom = getXMLDom('code_test.xml');  
		var cnt = getDomLength(pCode,xDom);
		var strHTML = ""  ;
		for(var i=0;i<cnt;i++)
		{
			if(getValue(pCode,i,"code") == pValue)
				strHTML = getValue(pCode,i,"text");
			}
		return strHTML;
	}



	</script>